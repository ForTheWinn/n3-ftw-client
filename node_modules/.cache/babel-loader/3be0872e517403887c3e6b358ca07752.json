{"ast":null,"code":"import { DEV_WALLET_PRIVATE_KEY, GAS_SCRIPT_HASH, NEO_SCRIPT_HASH } from \"../consts\";\nimport { CONST, rpc, sc, tx, u, wallet } from \"@cityofzion/neon-core\";\nimport { Network } from \"../network\";\nimport { convertContractCallParam } from \"../utils\";\nexport class DevWallet {\n  static async getAccount() {\n    return {\n      address: DevWallet.account.address,\n      label: \"DEV\"\n    };\n  }\n\n  static async getProvider() {\n    return {\n      name: \"Dev wallet\",\n      version: \"0.0\",\n      website: \"https://\",\n      // @ts-ignore\n      compatibility: [],\n      extra: {\n        currency: \"USD\",\n        theme: \"\"\n      }\n    };\n  }\n\n  static async getNetworks(network) {\n    return {\n      chainId: 4,\n      defaultNetwork: network,\n      networks: [\"MainNet\", \"TestNet\", \"N3MainNet\", \"N3TestNet\"]\n    };\n  }\n  /* Convert balance as neoline does */\n\n\n  static async getBalance(network) {\n    const rpcClient = Network.getRPCClient(network);\n    const res = await rpcClient.getNep17Balances(DevWallet.account.address);\n    const balances = [];\n    res.balance.forEach(item => {\n      let symbol;\n      let amount;\n\n      if (item.assethash.includes(GAS_SCRIPT_HASH)) {\n        symbol = \"GAS\";\n        amount = u.BigInteger.fromNumber(item.amount).toDecimal(8).toString();\n      }\n\n      if (item.assethash.includes(NEO_SCRIPT_HASH)) {\n        symbol = \"NEO\";\n        amount = item.amount;\n      }\n\n      balances.push({\n        contract: item.assethash,\n        amount,\n        symbol\n      });\n    });\n    return balances;\n  }\n\n  static async invoke(network, invokeScript) {\n    const rpcClient = Network.getRPCClient(network);\n    const txObj = await DevWallet.build(rpcClient, invokeScript, DevWallet.account.address);\n    const version = await rpcClient.getVersion();\n    txObj.sign(DevWallet.account, version.protocol.network);\n    const txid = await rpcClient.sendRawTransaction(txObj);\n    console.log(JSON.stringify({\n      RPC: rpc,\n      Transaction: txObj,\n      Network: version,\n      \"Network Fee\": txObj.networkFee.toDecimal(8).toString(),\n      \"System Fee\": txObj.systemFee.toDecimal(8).toString()\n    }, null, 4));\n    return {\n      txid,\n      nodeUrl: rpcClient.url\n    };\n  }\n\n}\nDevWallet.account = new wallet.Account(DEV_WALLET_PRIVATE_KEY);\n\nDevWallet.build = async (rpcClient, invokeScript, senderAddress, cosignerAddress) => {\n  const currentHeight = await rpcClient.getBlockCount(); // @ts-ignore\n\n  invokeScript.args = invokeScript.args.map(param => convertContractCallParam(param));\n  const script = sc.createScript({ ...invokeScript\n  });\n  const signers = [{\n    account: wallet.getScriptHashFromAddress(senderAddress),\n    scopes: tx.WitnessScope.Global\n  }];\n\n  if (cosignerAddress) {\n    signers.push({\n      account: wallet.getScriptHashFromAddress(cosignerAddress),\n      scopes: tx.WitnessScope.Global\n    });\n  }\n\n  const transaction = new tx.Transaction({\n    validUntilBlock: currentHeight + 1,\n    script,\n    signers\n  });\n  transaction.networkFee = await DevWallet.calculateNetworkFee(rpcClient, transaction);\n  const systemFee = await DevWallet.calculateSystemFee(rpcClient, transaction);\n  transaction.systemFee = systemFee; //\n  // if (cosigner) {\n  //   transaction.sign(cosigner, version.network);\n  // }\n\n  /* Temporary hard coding to solve NeonJS ordering bug */\n  // if (\n  //   transaction.witnesses[0].scriptHash !== sender.scriptHash &&\n  //   signers.length > 1\n  // ) {\n  //   let sig1 = transaction.witnesses[0];\n  //   let sig2 = transaction.witnesses[1];\n  //   transaction.witnesses[1] = sig1;\n  //   transaction.witnesses[0] = sig2;\n  // }\n\n  return transaction;\n};\n\nDevWallet.calculateNetworkFee = async (rpcClient, transaction) => {\n  const invokeFunctionResponse = await rpcClient.invokeFunction(CONST.NATIVE_CONTRACT_HASH.PolicyContract, \"getFeePerByte\");\n\n  if (invokeFunctionResponse.state !== \"HALT\") {\n    throw new Error(invokeFunctionResponse.exception ? invokeFunctionResponse.exception : \"Failed\");\n  }\n\n  const feePerByte = u.BigInteger.fromNumber( // @ts-ignore\n  invokeFunctionResponse.stack[0].value); // Account for witness size\n\n  const transactionByteSize = transaction.serialize().length / 2 + 109; // Hardcoded. Running a witness is always the same cost for the basic account.\n\n  const witnessProcessingFee = u.BigInteger.fromNumber( // In case of cosigner, check signer length check and mul the fee.\n  1000390 * (transaction.signers.length === 1 ? 1 : 3));\n  return feePerByte.mul(transactionByteSize).add(witnessProcessingFee);\n};\n\nDevWallet.calculateSystemFee = async (rpcClient, transaction) => {\n  const invokeFunctionResponse = await rpcClient.invokeScript(transaction.script, transaction.signers);\n\n  if (invokeFunctionResponse.state !== \"HALT\") {\n    throw new Error(invokeFunctionResponse.exception ? invokeFunctionResponse.exception : \"Failed\");\n  }\n\n  return u.BigInteger.fromNumber(invokeFunctionResponse.gasconsumed);\n};\n\nDevWallet.balanceCheck = async (rpcClient, sender, systemFee, networkFee, transferScript) => {\n  const res = await rpcClient.getNep17Balances(sender);\n  let gasBalance = 0;\n  const requiredGas = systemFee + networkFee;\n  let transferTokenBalance = 0;\n  res.balance.map(item => {\n    if (item.assethash.includes(GAS_SCRIPT_HASH)) {\n      gasBalance = u.Fixed8.fromRawNumber(item.amount).toNumber();\n    }\n\n    if (transferScript && transferScript.operation === \"transfer\" && item.assethash.includes(transferScript.scriptHash)) {\n      transferTokenBalance = u.Fixed8.fromRawNumber(item.amount).toNumber();\n    }\n  });\n\n  if (gasBalance < requiredGas) {\n    return false;\n  }\n\n  gasBalance = gasBalance - requiredGas;\n\n  if (transferScript && transferScript.operation === \"transfer\") {\n    const transferAmount = u.Fixed8.fromRawNumber( // @ts-ignore\n    transferScript.args[2].value).toNumber();\n\n    if (transferScript.scriptHash === GAS_SCRIPT_HASH) {\n      if (gasBalance < transferAmount) {\n        return false;\n      }\n    } else {\n      if (transferTokenBalance < transferAmount) {\n        return false;\n      }\n    }\n  }\n\n  return true;\n};","map":{"version":3,"sources":["/Users/ed/Projects/n3-ftw/client/src/packages/neo/wallet/dev-wallet.ts"],"names":["DEV_WALLET_PRIVATE_KEY","GAS_SCRIPT_HASH","NEO_SCRIPT_HASH","CONST","rpc","sc","tx","u","wallet","Network","convertContractCallParam","DevWallet","getAccount","address","account","label","getProvider","name","version","website","compatibility","extra","currency","theme","getNetworks","network","chainId","defaultNetwork","networks","getBalance","rpcClient","getRPCClient","res","getNep17Balances","balances","balance","forEach","item","symbol","amount","assethash","includes","BigInteger","fromNumber","toDecimal","toString","push","contract","invoke","invokeScript","txObj","build","getVersion","sign","protocol","txid","sendRawTransaction","console","log","JSON","stringify","RPC","Transaction","networkFee","systemFee","nodeUrl","url","Account","senderAddress","cosignerAddress","currentHeight","getBlockCount","args","map","param","script","createScript","signers","getScriptHashFromAddress","scopes","WitnessScope","Global","transaction","validUntilBlock","calculateNetworkFee","calculateSystemFee","invokeFunctionResponse","invokeFunction","NATIVE_CONTRACT_HASH","PolicyContract","state","Error","exception","feePerByte","stack","value","transactionByteSize","serialize","length","witnessProcessingFee","mul","add","gasconsumed","balanceCheck","sender","transferScript","gasBalance","requiredGas","transferTokenBalance","Fixed8","fromRawNumber","toNumber","operation","scriptHash","transferAmount"],"mappings":"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","sourcesContent":["import {\n  DEV_WALLET_PRIVATE_KEY,\n  GAS_SCRIPT_HASH,\n  NEO_SCRIPT_HASH,\n} from \"../consts\";\nimport { CONST, rpc, sc, tx, u, wallet } from \"@cityofzion/neon-core\";\nimport { BigInteger } from \"@cityofzion/neon-core/lib/u\";\nimport { INetworkType, Network } from \"../network\";\nimport { IBalance } from \"./interfaces\";\nimport { convertContractCallParam } from \"../utils\";\n\nexport class DevWallet {\n  static account = new wallet.Account(DEV_WALLET_PRIVATE_KEY);\n  static async getAccount() {\n    return {\n      address: DevWallet.account.address,\n      label: \"DEV\",\n    };\n  }\n\n  static async getProvider() {\n    return {\n      name: \"Dev wallet\",\n      version: \"0.0\",\n      website: \"https://\",\n      // @ts-ignore\n      compatibility: [],\n      extra: { currency: \"USD\", theme: \"\" },\n    };\n  }\n\n  static async getNetworks(network: INetworkType) {\n    return {\n      chainId: 4,\n      defaultNetwork: network,\n      networks: [\"MainNet\", \"TestNet\", \"N3MainNet\", \"N3TestNet\"],\n    };\n  }\n\n  /* Convert balance as neoline does */\n  static async getBalance(network: INetworkType) {\n    const rpcClient = Network.getRPCClient(network);\n    const res = await rpcClient.getNep17Balances(DevWallet.account.address);\n    const balances: IBalance[] = [];\n    res.balance.forEach((item) => {\n      let symbol;\n      let amount;\n      if (item.assethash.includes(GAS_SCRIPT_HASH)) {\n        symbol = \"GAS\";\n        amount = u.BigInteger.fromNumber(item.amount).toDecimal(8).toString();\n      }\n      if (item.assethash.includes(NEO_SCRIPT_HASH)) {\n        symbol = \"NEO\";\n        amount = item.amount;\n      }\n      balances.push({\n        contract: item.assethash,\n        amount,\n        symbol,\n      });\n    });\n    return balances;\n  }\n\n  static async invoke(\n    network: INetworkType,\n    invokeScript: sc.ContractCallJson\n  ) {\n    const rpcClient = Network.getRPCClient(network);\n    const txObj = await DevWallet.build(\n      rpcClient,\n      invokeScript,\n      DevWallet.account.address\n    );\n    const version: any = await rpcClient.getVersion();\n    txObj.sign(DevWallet.account, version.protocol.network);\n    const txid = await rpcClient.sendRawTransaction(txObj);\n    console.log(\n      JSON.stringify(\n        {\n          RPC: rpc,\n          Transaction: txObj,\n          Network: version,\n          \"Network Fee\": txObj.networkFee.toDecimal(8).toString(),\n          \"System Fee\": txObj.systemFee.toDecimal(8).toString(),\n        },\n        null,\n        4\n      )\n    );\n    return {\n      txid,\n      nodeUrl: rpcClient.url,\n    };\n  }\n\n  static build = async (\n    rpcClient: rpc.RPCClient,\n    invokeScript: sc.ContractCallJson,\n    senderAddress: string,\n    cosignerAddress?: string\n  ): Promise<tx.Transaction> => {\n    const currentHeight = await rpcClient.getBlockCount();\n    // @ts-ignore\n    invokeScript.args = invokeScript.args.map((param: any) =>\n      convertContractCallParam(param)\n    );\n    const script = sc.createScript({ ...invokeScript });\n\n    const signers = [\n      {\n        account: wallet.getScriptHashFromAddress(senderAddress),\n        scopes: tx.WitnessScope.Global,\n      },\n    ];\n    if (cosignerAddress) {\n      signers.push({\n        account: wallet.getScriptHashFromAddress(cosignerAddress),\n        scopes: tx.WitnessScope.Global,\n      });\n    }\n\n    const transaction = new tx.Transaction({\n      validUntilBlock: currentHeight + 1,\n      script,\n      signers,\n    });\n\n    transaction.networkFee = await DevWallet.calculateNetworkFee(\n      rpcClient,\n      transaction\n    );\n    const systemFee = await DevWallet.calculateSystemFee(\n      rpcClient,\n      transaction\n    );\n    transaction.systemFee = systemFee;\n    //\n    // if (cosigner) {\n    //   transaction.sign(cosigner, version.network);\n    // }\n    /* Temporary hard coding to solve NeonJS ordering bug */\n    // if (\n    //   transaction.witnesses[0].scriptHash !== sender.scriptHash &&\n    //   signers.length > 1\n    // ) {\n    //   let sig1 = transaction.witnesses[0];\n    //   let sig2 = transaction.witnesses[1];\n    //   transaction.witnesses[1] = sig1;\n    //   transaction.witnesses[0] = sig2;\n    // }\n    return transaction;\n  };\n\n  static calculateNetworkFee = async (\n    rpcClient: rpc.RPCClient,\n    transaction: tx.Transaction\n  ): Promise<BigInteger> => {\n    const invokeFunctionResponse = await rpcClient.invokeFunction(\n      CONST.NATIVE_CONTRACT_HASH.PolicyContract,\n      \"getFeePerByte\"\n    );\n\n    if (invokeFunctionResponse.state !== \"HALT\") {\n      throw new Error(\n        invokeFunctionResponse.exception\n          ? invokeFunctionResponse.exception\n          : \"Failed\"\n      );\n    }\n\n    const feePerByte = u.BigInteger.fromNumber(\n      // @ts-ignore\n      invokeFunctionResponse.stack[0].value\n    );\n    // Account for witness size\n    const transactionByteSize = transaction.serialize().length / 2 + 109;\n    // Hardcoded. Running a witness is always the same cost for the basic account.\n    const witnessProcessingFee = u.BigInteger.fromNumber(\n      // In case of cosigner, check signer length check and mul the fee.\n      1000390 * (transaction.signers.length === 1 ? 1 : 3)\n    );\n\n    return feePerByte.mul(transactionByteSize).add(witnessProcessingFee);\n  };\n\n  static calculateSystemFee = async (\n    rpcClient: rpc.RPCClient,\n    transaction: tx.Transaction\n  ) => {\n    const invokeFunctionResponse = await rpcClient.invokeScript(\n      transaction.script,\n      transaction.signers\n    );\n    if (invokeFunctionResponse.state !== \"HALT\") {\n      throw new Error(\n        invokeFunctionResponse.exception\n          ? invokeFunctionResponse.exception\n          : \"Failed\"\n      );\n    }\n\n    return u.BigInteger.fromNumber(invokeFunctionResponse.gasconsumed);\n  };\n\n  static balanceCheck = async (\n    rpcClient: rpc.RPCClient,\n    sender: string,\n    systemFee: number,\n    networkFee: number,\n    transferScript?: sc.ContractCallJson\n  ): Promise<boolean> => {\n    const res = await rpcClient.getNep17Balances(sender);\n    let gasBalance = 0;\n    const requiredGas = systemFee + networkFee;\n    let transferTokenBalance = 0;\n\n    res.balance.map((item) => {\n      if (item.assethash.includes(GAS_SCRIPT_HASH)) {\n        gasBalance = u.Fixed8.fromRawNumber(item.amount).toNumber();\n      }\n      if (\n        transferScript &&\n        transferScript.operation === \"transfer\" &&\n        item.assethash.includes(transferScript.scriptHash)\n      ) {\n        transferTokenBalance = u.Fixed8.fromRawNumber(item.amount).toNumber();\n      }\n    });\n\n    if (gasBalance < requiredGas) {\n      return false;\n    }\n\n    gasBalance = gasBalance - requiredGas;\n\n    if (transferScript && transferScript.operation === \"transfer\") {\n      const transferAmount = u.Fixed8.fromRawNumber(\n        // @ts-ignore\n        transferScript.args[2].value\n      ).toNumber();\n\n      if (transferScript.scriptHash === GAS_SCRIPT_HASH) {\n        if (gasBalance < transferAmount) {\n          return false;\n        }\n      } else {\n        if (transferTokenBalance < transferAmount) {\n          return false;\n        }\n      }\n    }\n    return true;\n  };\n}\n"]},"metadata":{},"sourceType":"module"}